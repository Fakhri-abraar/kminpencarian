{% extends "base.html" %}

{% block title %}My Files{% endblock %}

{% block content %}
<div class="container" style="margin-top: 2rem;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
        <h2 style="color: #667eea; margin: 0;">
            <i class="fas fa-folder-open"></i> My Encrypted Files
        </h2>
        <a href="{{ url_for('files.upload') }}" 
           style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 0.75rem 1.5rem; text-decoration: none; border-radius: 8px; font-weight: bold; transition: all 0.3s; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);"
           onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(102, 126, 234, 0.6)';"
           onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(102, 126, 234, 0.4)';">
            <i class="fas fa-plus"></i> Upload New File
        </a>
    </div>

    {% if files %}
    <div style="background: #fff3cd; border-left: 4px solid #f59e0b; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
        <p style="margin: 0; color: #856404;">
            <strong><i class="fas fa-info-circle"></i> Buttons Explained:</strong><br>
            <strong style="color: #667eea;">Decrypt</strong> - Download the original file (decrypted automatically).<br>
            <strong style="color: #f59e0b;">Raw</strong> - Download encrypted file (for testing/verification).<br>
            <strong style="color: #dc2626;">Delete</strong> - Permanently delete the file.
        </p>
    </div>
    
    <div style="background: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); overflow: hidden;">
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                    <th style="padding: 1rem; text-align: left; font-weight: bold;">
                        <i class="fas fa-file"></i> File Name
                    </th>
                    <th style="padding: 1rem; text-align: center; font-weight: bold;">
                        <i class="fas fa-hdd"></i> Size
                    </th>
                    <th style="padding: 1rem; text-align: center; font-weight: bold;">
                        <i class="fas fa-lock"></i> Algorithm
                    </th>
                    <th style="padding: 1rem; text-align: center; font-weight: bold;">
                        <i class="fas fa-tag"></i> Type
                    </th>
                    <th style="padding: 1rem; text-align: center; font-weight: bold;">
                        <i class="fas fa-calendar"></i> Upload Date
                    </th>
                    <th style="padding: 1rem; text-align: center; font-weight: bold;">
                        <i class="fas fa-cog"></i> Actions
                    </th>
                </tr>
            </thead>
            <tbody>
                {% for file in files %}
                <tr style="border-bottom: 1px solid #eee; transition: background 0.3s;"
                    onmouseover="this.style.background='#f8f9ff';"
                    onmouseout="this.style.background='white';">
                    <td style="padding: 1rem;">
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            {% if file.file_type == 'excel' %}
                                <i class="fas fa-file-excel" style="color: #1D6F42; font-size: 1.2rem;"></i>
                            {% elif file.file_type == 'image' %}
                                <i class="fas fa-file-image" style="color: #7C3AED; font-size: 1.2rem;"></i>
                            {% elif file.file_type == 'document' %}
                                <i class="fas fa-file-pdf" style="color: #DC2626; font-size: 1.2rem;"></i>
                            {% elif file.file_type == 'text' %}
                                <i class="fas fa-file-alt" style="color: #2563EB; font-size: 1.2rem;"></i>
                            {% else %}
                                <i class="fas fa-file" style="color: #6B7280; font-size: 1.2rem;"></i>
                            {% endif %}
                            <span style="font-weight: 500; color: #333;">{{ file.original_filename }}</span>
                        </div>
                    </td>
                    <td style="padding: 1rem; text-align: center; color: #666;">
                        {{ file.formatted_size }}
                    </td>
                    <td style="padding: 1rem; text-align: center;">
                        <span style="display: inline-block; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.85rem; font-weight: bold;
                            {% if file.encryption_algorithm == 'AES' %}
                                background: #DEF7EC; color: #03543F;
                            {% elif file.encryption_algorithm == 'DES' %}
                                background: #FDE8E8; color: #9B1C1C;
                            {% elif file.encryption_algorithm == 'RC4' %}
                                background: #E1EFFE; color: #1E429F;
                            {% endif %}
                        ">
                            {{ file.encryption_algorithm }}
                        </span>
                    </td>
                    <td style="padding: 1rem; text-align: center;">
                        <span style="text-transform: capitalize; color: #666; font-size: 0.9rem;">
                            {{ file.file_type }}
                        </span>
                    </td>
                    <td style="padding: 1rem; text-align: center; color: #666; font-size: 0.9rem;">
                        {{ file.upload_date.strftime('%Y-%m-%d %H:%M') }}
                    </td>
                    <td style="padding: 1rem; text-align: center;">
                        <div style="display: flex; gap: 0.5rem; justify-content: center; flex-wrap: wrap;">
                            
                            <a href="{{ url_for('files.download_logic', file_id=file.id) }}" 
                               style="background: #667eea; color: white; padding: 0.5rem 1rem; text-decoration: none; border-radius: 6px; font-size: 0.9rem; transition: all 0.3s; display: inline-flex; align-items: center; gap: 0.25rem;"
                               onmouseover="this.style.background='#5568d3';"
                               onmouseout="this.style.background='#667eea';"
                               title="Download and decrypt file">
                                <i class="fas fa-unlock"></i> Decrypt
                            </a>
                            
                            <a href="{{ url_for('files.download_encrypted', file_id=file.id) }}" 
                               style="background: #f59e0b; color: white; padding: 0.5rem 1rem; text-decoration: none; border-radius: 6px; font-size: 0.9rem; transition: all 0.3s; display: inline-flex; align-items: center; gap: 0.25rem;"
                               onmouseover="this.style.background='#d97706';"
                               onmouseout="this.style.background='#f59e0b';"
                               title="Download encrypted file (raw ciphertext)">
                                <i class="fas fa-lock"></i> Raw
                            </a>
                            
                            <form method="POST" action="{{ url_for('files.delete', file_id=file.id) }}" style="display: inline; margin: 0;"
                                  onsubmit="return confirm('Are you sure you want to delete {{ file.original_filename }}? This action cannot be undone.');">
                                <button type="submit" 
                                        style="background: #dc2626; color: white; padding: 0.5rem 1rem; border: none; border-radius: 6px; cursor: pointer; font-size: 0.9rem; transition: all 0.3s; display: inline-flex; align-items: center; gap: 0.25rem;"
                                        onmouseover="this.style.background='#b91c1c';"
                                        onmouseout="this.style.background='#dc2626';"
                                        title="Delete file">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            </form>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div style="margin-top: 2rem; display: flex; gap: 1rem; flex-wrap: wrap;">
        <div style="flex: 1; min-width: 200px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 1.5rem; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); color: white;">
            <h3 style="margin: 0 0 0.5rem 0; font-size: 2rem;">{{ files|length }}</h3>
            <p style="margin: 0; opacity: 0.9;">Total Files</p>
        </div>
        
        <div style="flex: 1; min-width: 200px; background: white; padding: 1.5rem; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
            <h3 style="margin: 0 0 0.5rem 0; font-size: 2rem; color: #667eea;">
                {{ files|sum(attribute='file_size')|filesizeformat if files else '0 B' }}
            </h3>
            <p style="margin: 0; color: #666;">Total Storage</p>
        </div>
        
        <div style="flex: 1; min-width: 200px; background: white; padding: 1.5rem; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
            <h3 
            style="margin: 0 0 0.5rem 0; font-size: 2rem; color: #764ba2;">
            </h3>
            <p style="margin: 0; color: #666;">All Encrypted</p>
        </div>
    </div>

    {% else %}
    <div style="text-align: center; padding: 4rem 2rem; background: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
        <i class="fas fa-folder-open" style="font-size: 4rem; color: #ddd; margin-bottom: 1rem;"></i>
        <h3 style="color: #666; margin-bottom: 1rem;">No files uploaded yet</h3>
        <p style="color: #999; margin-bottom: 2rem;">Start by uploading your first encrypted file!</p>
        <a href="{{ url_for('files.upload') }}" 
           style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 1rem 2rem; text-decoration: none; border-radius: 8px; font-weight: bold; display: inline-block; transition: all 0.3s; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);"
           onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(102, 126, 234, 0.6)';"
           onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(102, 126, 234, 0.4)';">
            <i class="fas fa-upload"></i> Upload Your First File
        </a>
    </div>
    {% endif %}
</div>

<style>
@media (max-width: 768px) {
    table {
        font-size: 0.85rem;
    }
    
    th, td {
        padding: 0.75rem !important;
    }
    
    .container {
        padding: 1rem;
    }
}
</style>
{% endblock %}